---
title: Pythonista3ï¼ˆWKWebViewï¼‰ ã¨JavaScript ã®æ„›ã¨å‹æƒ…ã®ãƒ„ãƒ¼ãƒ—ãƒ©ãƒˆãƒ³ ã€œ ã‚³ãƒ¼ãƒ‰é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã— ã€œã€‚GLSL ã§éŠã¶ã§ï¼
tags:
  - Python
  - JavaScript
  - WebGL
  - GLSL
  - Pythonista3
private: false
updated_at: '2022-12-25T07:01:16+09:00'
id: d0a21d40731644c696fd
organization_url_name: null
slide: false
ignorePublish: false
---

ã“ã®è¨˜äº‹ã¯ã€[Pythonista3 Advent Calendar 2022](https://qiita.com/advent-calendar/2022/pythonista3) ã® 25 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ğŸ‘‡ : 24 æ—¥ç›®

https://qiita.com/pome-ta/items/52053dd6c9e39da6a29a

ğŸ‘‡ : 26 æ—¥ç›®

https://qiita.com/pome-ta/items/77a4fe632244919f1709

https://qiita.com/advent-calendar/2022/pythonista3

ä¸€æ–¹çš„ãªåã£ãŸç›®ç·šã§ã€Pythonista3 ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

ã»ã¼æ¯æ—¥ iPhoneï¼ˆPythonista3ï¼‰ã§ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã—ã¦ã„ã‚‹è€…ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚

ä»¥ä¸‹ã€ç§ã® 2022 å¹´ 12 æœˆæ™‚ç‚¹ã®ç’°å¢ƒã§ã™ã€‚

```sysInfo.log
--- SYSTEM INFORMATION ---
* Pythonista 3.3 (330025), Default interpreter 3.6.1
* iOS 16.1.1, model iPhone12,1, resolution (portrait) 828.0 x 1792.0 @ 2.0
```

ä»–ã®ç’°å¢ƒ(iPad ã‚„ç«¯æœ«ã®ç¨®é¡ã€iOS ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„)ã§ã¯ã€æ„å›³ã¨ã—ãªã„æŒ™å‹•(ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹)ãªã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚

ã¡ãªã¿ã«ã€`model iPhone12,1` ã¯ã€iPhone11 ã§ã™ã€‚

## ã“ã®è¨˜äº‹ã§ã‚ã‹ã‚‹ã“ã¨

- Pythonista3 ã‚’ä½¿ã£ãŸ JavaScriptï¼ˆWebGLï¼‰ é–‹ç™º
- Pythonista3ï¼ˆWKWebViewï¼‰ ã¨ã€JavaScript é–“ã®ãƒ‡ãƒ¼ã‚¿é€£æº
- ï¼ˆWebGL ã®æ¥½ã—ã•ã¨ã€GLSL ã®æ¥½ã—ã•ï¼‰

## æ°—ãŒã¤ã‘ã°æœ€çµ‚æ—¥

Advent Calendar ã‚‚ 25 æ—¥ç›®ã€‚ã„ã‚ˆã„ã‚ˆæœ€çµ‚æ—¥ã§ã™ã€‚ãã—ã¦ã€ã¤ã¾ã‚Šã¯ã‚¯ãƒªã‚¹ãƒã‚¹ã§ã™ã­ã€‚

Python ãŒå®Ÿè¡Œã§ãã‚‹ iOS, iPadOS ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ã€Pythonista3ã€‚

ãã® Pythonista3 ç´¹ä»‹è¨˜äº‹ã®ã‚¢ãƒ‰ã‚«ãƒ¬æœ€çµ‚æ—¥ã®ãƒ†ãƒ¼ãƒãŒã€JavaScript ã® WebGLï¼ˆãã—ã¦ GLSLï¼‰ã€‚

ä¼ç·šã§ã‚‚ã€é‹å‘½ã§ã‚‚ã€ä½•ã‹ã«ä»•çµ„ã¾ã‚ŒãŸã€‚ãªã‚“ã¦ã“ã¨ã¯å…¨ããªãã€ãŸã ãŸã ç§ãŒç´¹ä»‹ã—ãŸã„ã ã‘ãªã®ã§ã™ ğŸ˜‡

Pythonista3 ã®æ„å¤–ãªä½¿ã„æ–¹ã€ç‰¹æ®Šãªæ´»ç”¨æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ç§ã‹ã‚‰ã®ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã§ã™ã€‚ã“ã‚Œã§ã‚‚ãã‚‰ãˆ ğŸ

### ä»Šå›ã®æµã‚Œ

åŸºæœ¬çš„ã«ã€`wkwebview.py` ã®æ´»ç”¨ã‚’ãƒ¡ã‚¤ãƒ³ã«å®Ÿè£…ã€ç´¹ä»‹ã‚’ã—ã¦ã„ãã¾ã™ã€‚

- ã‚ªãƒªã‚¸ãƒŠãƒ«
  - [mikaelho/pythonista-webview: WKWebView implementation for Pythonista](https://github.com/mikaelho/pythonista-webview)

https://github.com/mikaelho/pythonista-webview

- ç§ãŒãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸã‚‚ã®
  - [pome-ta/pythonista-webview: WKWebView implementation for Pythonista](https://github.com/pome-ta/pythonista-webview)
  - `console` å‡¦ç†ã®éƒ¨åˆ†ã‚’ä¸€éƒ¨æ”¹å¤‰

https://github.com/pome-ta/pythonista-webview

WebGL ã®éƒ¨åˆ†ã¯ã€ã‚³ãƒ¼ãƒ‰ã®ç´¹ä»‹ã®ã¿ã«ç•™ã‚ã¾ã™ã€‚ã»ã¼çŸ¥ã£ã¦ã„ã‚‹å‰æã§èª¬æ˜ã‚’ã—ã¦ã—ã¾ã„ã¾ã™ï¼ˆã™ã¿ã¾ã›ã‚“ï¼‰ã€‚

è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯ã€éšæ™‚å‡ºã¦ãã‚‹ãƒªãƒ³ã‚¯å…ˆã‚’å‚ç…§ãã ã•ã„ã€‚

[WebGL: ã‚¦ã‚§ãƒ–ã® 2D ãŠã‚ˆã³ 3D ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/WebGL_API)

https://developer.mozilla.org/ja/docs/Web/API/WebGL_API

## Pythonista3 -> WKWebView -> HTML | JavaScript -> WebGL; JavaScript -> WKWebView -> Pythonista3

å®Ÿè¡Œã™ã‚‹ã¨ã€Pythonista3 ã® View ã€€ã§ WebGL å®Ÿè£…ã® GLSL ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãŒæç”»ã•ã‚Œã¦ã„ã¾ã™ã€‚

`textarea` ã§ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æç”»ã‚‚ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã§åæ˜ ã•ã‚Œã¾ã™ã€‚

View ã‚’é–‰ã˜ã‚‹ã¨ã€é–‰ã˜ã‚‹ç›´å‰ã«`textarea` ã¸è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ï¼ˆã‚³ãƒ¼ãƒ‰ã®æ–‡å­—åˆ—ï¼‰ã‚’ Pythonista3 å´ã§å—ã‘å–ã‚Šã¾ã™ã€‚

ä»Šå›ã¯ã€Pythonista3 ã§å—ã‘ãŸã‚³ãƒ¼ãƒ‰ã‚’ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«è¨­ç½®ã—ã¦ã„ã‚‹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã¸ä¸Šæ›¸ãã‚’ã—ã¦ã„ã¾ã™ã€‚

ä»Šå›ã®å®Ÿè£…ã§ã¯ã€

- Pythonista3 ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ç·¨é›†
- ç·¨é›†å†…å®¹ã‚’ View ã§æç”»ç¢ºèª
  - View ä¸Šã§ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†
  - View ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¸åæ˜ 
- Pythonista3 ãƒ­ãƒ¼ã‚«ãƒ«ã§ã€View ç·¨é›†æ™‚ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¶™ç¶šç·¨é›†

ã¨ã€View ä¸Šã¨ã€Pythonista3 ã®ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã‚’è¡Œãæ¥ã—ãªãŒã‚‰ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’æ›¸ãã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

### äº‹å‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹æº–å‚™

å®Ÿè£…ã™ã‚‹å‰ã«ä¸‹æº–å‚™ã‚’ãŠã“ãªã„ã¾ã™ã€‚å‰å›ç´¹ä»‹è¨˜äº‹ã®æ§‹æˆã¨åŸºæœ¬çš„ãªå¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“:

```ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
.
â”œâ”€â”€ main.py                       <- Pythonista3 ã§View ã‚’å‘¼ã³å‡ºã™éƒ¨åˆ†
â”œâ”€â”€ docs                          <- Web ã‚¢ãƒ—ãƒªã®éƒ¨åˆ†
â”‚Â Â  â”œâ”€â”€ css
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ style.css
â”‚Â Â  â”‚Â Â  â””â”€â”€ styleChecker.css
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ js
â”‚Â Â  â”‚Â Â  â””â”€â”€ glCanvas.js
â”‚Â Â  â””â”€â”€ shaders
â”‚Â Â      â”œâ”€â”€ fragment
â”‚Â Â      â”‚Â Â  â””â”€â”€ fragmentMain.js
â”‚Â Â      â””â”€â”€ vertex
â”‚Â Â          â””â”€â”€ vertexMain.js
â””â”€â”€ wkwebview.py                  <- pythonista-webview ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ç§»æ¤
```

### `./docs/` å†…

html ã‚„ js ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€Web ã‚¢ãƒ—ãƒªå´ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã§ã™ã€‚

åŸºæœ¬çš„ã«ã€é€šå¸¸é€šã‚Š Web ãƒ•ãƒ­ãƒ³ãƒˆå´ã®å®Ÿè£…ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

Pythonista3ï¼ˆWKWebViewï¼‰ å´ã‚’æ„è­˜ã›ãšã«ã€å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚

#### `./docs/index.html`

```index.html
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <link rel="stylesheet" href="./css/style.css">
  <script type="module">
    import eruda from 'https://cdn.skypack.dev/eruda';
    eruda.init();
  </script>
  <script type="module" src="./js/glCanvas.js" ></script>
  <title>WebGL ã§GLSL</title>
</head>
<body></body>
</html>

```

ãŸã ãŸã ã€ç§ã®ã€Œç™–ã€ã§ã—ã‹ãªã„ã®ã§ã™ãŒã€äº‹å‰ã«`<body></body>` ã‚¿ã‚°å†…ã«ã¯ã€ä½•ã‚‚å…¥ã‚Œãš JavaScript å´ã§æ“ä½œã‚’ã—ã¾ã™ã€‚

PC ã®æ½¤æ²¢ãªã‚¨ãƒ‡ã‚£ã‚¿ãŸã¡ãŒã‚ã‚Œã°ã€ã“ã®ã‚ˆã†ãªæ›¸ãæ–¹ã¯ï¼ˆå¤šåˆ†ï¼‰ã—ã¾ã›ã‚“ãŒã€Pythonista3 ã§ã‚ã‚‹ã¨ã‚³ãƒ¼ãƒ‰é–“ã®è¡Œãæ¥ãŒé¢å€’ã«ãªã£ã¦ã—ã¾ã„ã€åŸºæœ¬çš„ã«ç·¨é›†ã‚’ã™ã‚‹ JavaScript ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ã“ã­ã“ã­ã—ã¦ã—ã¾ã£ã¦ãŠã‚Šã¾ã™ã€‚

#### `./docs/css/style.css`

```style.css
@charset "utf-8";
/* @import url('./styleChecker.css'); */

html {
  height: 100%;
}
body {
  max-width: 720px;
  height: 100vh;
  height: 100dvh;
  margin: auto;

  background-color: darkslategray;
  color: #353535;
}

#wrap {
  height: 100%;
  display: flex;
  margin: 0 1rem;
  flex-direction: column;
  /*justify-content: center;*/
  align-items: center;
}

#myCanvas {
  margin: 1rem;
}

```

css ã‚‚ html åŒæ§˜ã«ã€ã‚ã¾ã‚Šæ›¸ããŸããªã„ã®ã§ã™ãŒã€JavaScript ã¨ãªã‚‹ã¨ç…©é›‘åŒ–ã€å‡¦ç†ã®ç„¡é§„æ„ŸãŒã‚ã‚‹ã®ã§ã€æœ€ä½é™ã¯æ›¸ã„ã¦ã„ã¾ã™ã€‚

JavaScript å´ã§æ›¸ãã¨ãªã‚‹ã¨ã€çµå±€ã®ã¨ã“ã‚æ–‡å­—åˆ—æ“ä½œã«ãªã£ã¦ã—ã¾ã„ã€ã„ã‚ã„ã‚ã¨æ„å‘³ãŒç„¡ããªã£ã¦ã—ã¾ã†ã®ã§ã€‚ã€‚ã€‚

ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹ã€`@import url('./styleChecker.css');` ã¯ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ã‚„éšå±¤ã‚’ã†ã£ã™ã‚‰è‰²ä»˜ã‘ã‚’ã—ã¦ãã‚Œã‚‹ã®ã§ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèªã«å½¹ç«‹ã¡ã¾ã™ã€‚

æ°—è»½ã« devtools ã‚’ä½¿ãˆãªã„è‹¦è‚‰ã®ç­–ã® hack ã§ã™ã­ã€‚

[CSS ã§å®Ÿè£…ã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ§‹é€ ã‚„éšå±¤ã‚’ç°¡å˜ã«ç¢ºèªã§ãã‚‹ã€ç§ã®ãŠæ°—ã«å…¥ã‚Šã® CSS ãƒãƒƒã‚¯ -My favorite CSS hack | ã‚³ãƒªã‚¹](https://coliss.com/articles/build-websites/operation/css/my-favorite-css-hack-by-gajus.html)

https://coliss.com/articles/build-websites/operation/css/my-favorite-css-hack-by-gajus.html

[My favorite CSS hack - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»](https://dev.to/gajus/my-favorite-css-hack-32g3)

https://dev.to/gajus/my-favorite-css-hack-32g3

#### `./docs/shaders`

é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã¨ã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’åˆ†ã‘ã¦æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

æ‹¡å¼µå­ãŒ`.js` ã¨ãªã£ã¦ã„ã‚‹ã®ã¯ã€Pythonista3 ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§ç·¨é›†ã‚’ã—ãŸã„ãŸã‚ã§ã™ã€‚

`.py` ã‚ˆã‚Šã‚‚ã€ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆçš„ã«ã¯`.js` ã®æ–¹ãŒè¿‘ã„ã§ã™ã€‚

ã¾ãŸã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã®æ‹¡å¼µå­ã¯`.vert`, `.frag` ç­‰ãŒã‚ˆãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

Pythonista3 ã§ãã®ã‚ˆã†ãªæ‹¡å¼µå­ã‚’é–‹ã“ã†ã¨ã™ã‚‹ã¨ã€ç„¡é§„ã«ãƒ¯ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¿…è¦ãªã®ã¨ã€ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãªã—ã®ç·¨é›†ã¨ãªã‚‹ã®ã§ã€`.js` ã®æ–¹ãŒã„ã„ãªã€‚ã¨ã„ã†ãƒ¬ãƒ™ãƒ«ã®ç†ç”±ã§ã™ã€‚

```fragmentMain.js
#version 300 es
precision highp float;

out vec4 fragColor;

uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

void main() {
  vec2 p = (gl_FragCoord.xy * 2.0 - resolution) / min(resolution.x, resolution.y);
  vec3 outColor = vec3(p, abs(sin(time)));

  fragColor = vec4(outColor, 1.0);
}

```

```vertexMain.js
#version 300 es
in  vec3 position;
void main(){
    gl_Position = vec4(position, 1.0);
}

```

æ³¨æ„ç‚¹ã¨ã—ã¦ã¯ã€`#version 300 es` ã‚’å¿…ãš 1 è¡Œç›®ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚1 è¡Œç›®ä»¥å¤–ã ã¨èª­ã¿è¾¼ã¿ã¾ã›ã‚“ã€‚

è„±ç·šã—ã¾ã™ãŒã€ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ä¾‹ã¨ã—ã¦ã€js ä¸Šã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã‚’ä½¿ã†å ´é¢ã§ã™:

```.js
// ä¸€è¡Œç›®ãŒç©ºè¡Œã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹
const NG_vertexCode = `
#version 300 es
in  vec3 position;
void main(){
    gl_Position = vec4(position, 1.0);
}
`

// ãƒãƒƒã‚¯ã‚¯ã‚ªãƒ¼ãƒˆç›´å¾Œã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã§ã€ä¸€è¡Œç›®ã‹ã‚‰ã®æ–‡å­—åˆ—ã¨ãªã‚‹
const OK_vertexCode = `#version 300 es
in  vec3 position;
void main(){
    gl_Position = vec4(position, 1.0);
}

```

#### `./docs/js/glCanvas.js`

ã„ã‚ˆã„ã‚ˆ WebGL ã‚³ã‚¢ã®éƒ¨åˆ†ã§ã™ã€‚

```glCanvas.js
// sample_068
//
// GLSL ã ã‘ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
// https://wgld.org/d/glsl/g001.html

// ã‚’ã€å‚ç…§ã€‚ä¸€éƒ¨æ”¹å¤‰

// global
let gl;
const uniLocation = new Array();

let cnvs, cnvsWidth, cnvsHeight;
let mouseX = 0.5;
let mouseY = 0.5;

// render ãƒ«ãƒ¼ãƒ—é–¢ä¿‚
let time = 0.0;
let prevTimestamp = 0;
const FPS = 120;
const frameTime = 1 / FPS;

// ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰é–¢ä¿‚
let prevFragmentCode = '';

const vs = './shaders/vertex/vertexMain.js';
const fs = './shaders/fragment/fragmentMain.js';

const vertexPrimitive = await fetchShader(vs);
const fragmentPrimitive = await fetchShader(fs);

async function fetchShader(path) {
  const res = await fetch(path);
  const shaderText = await res.text();
  return shaderText;
}

const setupDOM = () => {
  const wrapDiv = document.createElement('div');
  wrapDiv.id = 'wrap';
  const canvas = document.createElement('canvas');
  canvas.id = 'myCanvas';
  const textArea = document.createElement('textarea');
  textArea.id = 'textArea';
  textArea.value = fragmentPrimitive;
  textArea.style.width = '100%';
  textArea.style.height = '100%';
  document.body.appendChild(wrapDiv);
  wrapDiv.appendChild(canvas);
  wrapDiv.appendChild(textArea);

  textArea.addEventListener('input', (event) => {
    const textareaValue = event.target.value;
    const fragCode = textareaValue.replace(/\r?\n/g, '');
    if (prevFragmentCode != fragCode) {
      setupGL(vertexPrimitive, textareaValue);
      prevFragmentCode = fragCode;
    }
  });
};

setupDOM();
window.addEventListener('load', setupGL(vertexPrimitive, fragmentPrimitive));

function setupGL(vertexSource, fragmentSource) {
  // todo: js ã§ç”Ÿæˆã—ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°ã€ç·¨é›†ã‚ˆã‚Šå–å¾—ã§ã‚‚ã„ã„ã‹ã‚‚
  // ç”»é¢ã‚µã‚¤ã‚ºã‚ˆã‚Šcanvas ã‚µã‚¤ã‚ºã‚’è¨­å®š
  cnvsWidth = document.querySelector('#wrap').clientWidth;
  cnvsHeight = cnvsWidth * 0.64; // ã„ã„æ„Ÿã˜ã®ã‚µã‚¤ã‚ºèª¿æ•´
  // canvas ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
  cnvs = document.querySelector('#myCanvas');
  cnvs.width = cnvsWidth;
  cnvs.height = cnvsHeight;

  // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
  // todo: touch ã‚¤ãƒ™ãƒ³ãƒˆã¸
  cnvs.addEventListener('mousemove', mouseMove, true);

  gl = cnvs.getContext('webgl2');
  // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã¨ãƒªãƒ³ã‚¯
  const prg = create_program(
    // é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ã¨ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã®ç”Ÿæˆ
    create_shader('vs', vertexSource),
    create_shader('fs', fragmentSource)
  );
  uniLocation[0] = gl.getUniformLocation(prg, 'time');
  uniLocation[1] = gl.getUniformLocation(prg, 'mouse');
  uniLocation[2] = gl.getUniformLocation(prg, 'resolution');

  // é ‚ç‚¹ãƒ‡ãƒ¼ã‚¿å›ã‚Šã®åˆæœŸåŒ–
  const position = [
    -1.0, 1.0, 0.0, 1.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0, -1.0, 0.0,
  ];
  const index = [0, 2, 1, 1, 2, 3];

  const vPosition = create_vbo(position);
  const vIndex = create_ibo(index);
  const vAttLocation = gl.getAttribLocation(prg, 'position');

  gl.bindBuffer(gl.ARRAY_BUFFER, vPosition);
  gl.enableVertexAttribArray(vAttLocation);
  gl.vertexAttribPointer(vAttLocation, 3, gl.FLOAT, false, 0, 0);
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, vIndex);

  // ãã®ä»–ã®åˆæœŸåŒ–
  gl.clearColor(0.0, 0.0, 0.0, 1.0);
  mouseX = 0.5;
  mouseY = 0.5;

  renderLoop(); // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°å‘¼å‡º
}

function renderLoop(timestamp) {
  const elapsed = (timestamp - prevTimestamp) / 1000;
  if (elapsed <= frameTime) {
    requestAnimationFrame(renderLoop);
    return;
  }
  prevTimestamp = timestamp;
  time += frameTime;
  glRender(time);
  requestAnimationFrame(renderLoop); // å†å¸°
}

function glRender(time) {
  gl.clear(gl.COLOR_BUFFER_BIT); // ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ•ã‚¡ã‚’ã‚¯ãƒªã‚¢
  // uniform é–¢é€£
  gl.uniform1f(uniLocation[0], time);
  gl.uniform2fv(uniLocation[1], [mouseX, mouseY]);
  gl.uniform2fv(uniLocation[2], [cnvsWidth, cnvsHeight]);
  gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0); // æç”»
  gl.flush();
}

// mouse
function mouseMove(e) {
  mouseX = e.offsetX / cnvsWidth;
  mouseY = e.offsetY / cnvsHeight;
}

/* ã‚·ã‚§ãƒ¼ãƒ€ã‚’ç”Ÿæˆãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹é–¢æ•° */
function create_shader(type, text) {
  let shader;
  // scriptã‚¿ã‚°ã®typeå±æ€§ã‚’ãƒã‚§ãƒƒã‚¯
  switch (type) {
    case 'vs': // é ‚ç‚¹ã‚·ã‚§ãƒ¼ãƒ€ã®å ´åˆ
      shader = gl.createShader(gl.VERTEX_SHADER);
      break;
    case 'fs': // ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã®å ´åˆ
      shader = gl.createShader(gl.FRAGMENT_SHADER);
      break;
    default:
      return;
  }

  gl.shaderSource(shader, text); // ç”Ÿæˆã•ã‚ŒãŸã‚·ã‚§ãƒ¼ãƒ€ã«ã‚½ãƒ¼ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹
  gl.compileShader(shader); // ã‚·ã‚§ãƒ¼ãƒ€ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹
  // ã‚·ã‚§ãƒ¼ãƒ€ãŒæ­£ã—ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
  if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
    return shader; // æˆåŠŸã—ã¦ã„ãŸã‚‰ã‚·ã‚§ãƒ¼ãƒ€ã‚’è¿”ã—ã¦çµ‚äº†
  } else {
    // å¤±æ•—ã—ã¦ã„ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆã—ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
    // alert(gl.getShaderInfoLog(shader));
    console.log(gl.getShaderInfoLog(shader));
  }
}

// ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã‚·ã‚§ãƒ¼ãƒ€ã‚’ãƒªãƒ³ã‚¯ã™ã‚‹é–¢æ•°
function create_program(vs, fs) {
  const program = gl.createProgram(); // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ

  // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚·ã‚§ãƒ¼ãƒ€ã‚’å‰²ã‚Šå½“ã¦ã‚‹
  gl.attachShader(program, vs);
  gl.attachShader(program, fs);
  gl.linkProgram(program); // ã‚·ã‚§ãƒ¼ãƒ€ã‚’ãƒªãƒ³ã‚¯

  // ã‚·ã‚§ãƒ¼ãƒ€ã®ãƒªãƒ³ã‚¯ãŒæ­£ã—ãè¡Œãªã‚ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
  if (gl.getProgramParameter(program, gl.LINK_STATUS)) {
    gl.useProgram(program); // æˆåŠŸã—ã¦ã„ãŸã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹
    return program; // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¦çµ‚äº†
  } else {
    return null; // å¤±æ•—ã—ã¦ã„ãŸã‚‰ NULL ã‚’è¿”ã™
  }
}

// VBOã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function create_vbo(data) {
  const vbo = gl.createBuffer(); // bufferObject ã®ç”Ÿæˆ

  gl.bindBuffer(gl.ARRAY_BUFFER, vbo); // buffer ã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW); // buffer ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
  gl.bindBuffer(gl.ARRAY_BUFFER, null); // buffer ã®ãƒã‚¤ãƒ³ãƒ‰ã‚’ç„¡åŠ¹åŒ–

  return vbo; // ç”Ÿæˆã—ãŸ VBO ã‚’è¿”ã—ã¦çµ‚äº†
}

// IBOã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function create_ibo(data) {
  const ibo = gl.createBuffer(); // bufferObjectã®ç”Ÿæˆ

  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo); // buffer ã‚’ãƒã‚¤ãƒ³ãƒ‰
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Int16Array(data), gl.STATIC_DRAW); // buffer ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null); // buffer ã®ãƒã‚¤ãƒ³ãƒ‰ã‚’ç„¡åŠ¹åŒ–

  return ibo; // ç”Ÿæˆã—ãŸIBOã‚’è¿”ã—çµ‚äº†
}

```

èª¿å­ã«ã®ã£ã¦ã€`webgl2` ã§ã® GLSL ã«ã—ã¦ã¿ã¾ã—ãŸã€‚ã¾ã ã¾ã ç†è§£ã§ãã¦ã„ãªã„ã®ã§ç„¡æ„å‘³ãªéƒ¨åˆ†ãŒå¤šã€…ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

å®Ÿè£…å†…å®¹ã«é–¢ã—ã¦ã¯ã€wgld.org ã‚’é€²ã‚ã¦ã„ã‘ã°ç†è§£ã§ãã¾ã™ã€‚

[wgld.org](https://wgld.org/)

https://wgld.org/

ç§ã¯ã€å„ç« ã‚’å†™çµŒã—ã¦å‹‰å¼·ã—ã¦ã„ã¾ã™ï¼ˆPythonista3 ã§ï¼‰ã€‚

æœ€å…ˆç«¯ã® WebGL ã§ã™ã¨ã€iPhone ãŒå¯¾å¿œã—ã¦ã„ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ãªéƒ¨åˆ†ã¯ iPhone ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹ã®ã§ã€ãƒšãƒ¼ã‚¸ã«è¡Œãå‹•ã„ã¦ã„ã‚Œã°å®Ÿè£…å¯èƒ½ã§ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒ`var` ã§å¤‰æ•°å®£è¨€ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`const`, `let` ã§æ›¸ãæ›ãˆã¤ã¤ã€WebGL å†…ã®æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã„ã‘ã°ã€ã©ã‚“ãªæ‰‹é †ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã®ã‹æµã‚ŒãŒç†è§£ã§ãã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

##### ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å–å¾—

wgld.org ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€`index.html` å†…ã«ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—èª­ã¿è¾¼ã¿ã‚’ã•ã›ã¦ã„ã¾ã™ã€‚

ç§ã¯ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å€‹åˆ¥ã«å­˜åœ¨ã—ã¦ã„ãŸæ–¹ãŒç·¨é›†ç®¡ç†ã—ã‚„ã™ã„ã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã•ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```.js
// ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰é–¢ä¿‚
let prevFragmentCode = '';

const vs = './shaders/vertex/vertexMain.js';
const vertexPrimitive = await fetchShader(vs);

const fs = './shaders/fragment/frag300.js';
const fragmentPrimitive = await fetchShader(fs);

async function fetchShader(path) {
  const res = await fetch(path);
  const shaderText = await res.text();
  return shaderText;
}
```

åŒæœŸéåŒæœŸãƒ»Promise, async/awaitã€ã«ã¤ã„ã¦å®Œå…¨ã«ã€Œé›°å›²æ°—ã€ã§ã‚„ã£ã¦ã„ã‚‹ã®ã§ã€å¤‰ãªå®Ÿè£…ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã€Œå‹•ãã‹ã‚‰ãƒ¨ã‚·ï¼ã€ã®ç²¾ç¥ã§å®Ÿè£…ã•ã›ã¦ã‚‚ã‚‰ã£ã¦ã„ã¾ã™ã€‚

`setupGL` é–¢æ•°å†…ã§ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ã‚³ãƒ¼ãƒ‰æƒ…å ±ã‚’åæ˜ ã•ã›ã‚‹ã“ã¨ã«ã—ã¦ãŠã‚Šã€`window.onload` æ™‚ã«ã€å‡¦ç†ãŒèµ°ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

å¼•æ•°ã¨ã—ã¦ã€å¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚æŒ‡å®šã›ãšã«ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã®å¤‰æ•°ã§é–¢æ•°å†…ã§å‘¼ã³å‡ºã—ã¦ã‚‚ã€å–å¾—ãŒã§ãã¾ã›ã‚“ã®ã§ãŠæ°—ã‚’ã¤ã‘ãã ã•ã„ã€‚

```.js
window.addEventListener('load', setupGL(vertexPrimitive, fragmentPrimitive));
```

### Pythonista3 å´ã®å‡¦ç†

ã‹ãªã‚Šé§†ã‘è¶³ã§ Web ã‚¢ãƒ—ãƒªå´ã®èª¬æ˜ã‚’ã—ã¾ã—ãŸã€‚WebGL ã®éƒ¨åˆ†ã¯ä½™è£•ã§ 25 æ—¥é–“åˆ†ä»¥ä¸Šã®è¨˜äº‹ã«ãªã‚‹ãƒ¬ãƒ™ãƒ«ã§ã™ã®ã§ã€ä»Šå›ã¯ã‚³ãƒ”ãƒšã—ãŸã‚‰å‹•ã„ãŸã€‚çŠ¶æ…‹ã§å•é¡Œãªã„ã§ã™ã€‚

Pythonista3 ã® View å´ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`wkwebview.py` ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦è¨­ç½®ã—ã¦ã„ã‚‹ã®ã§ã€ç›´æ¥æ›¸ãåŠ ãˆãŸã‚Šã¯ã—ã¾ã›ã‚“ã€‚`main.py` ã§å®Ÿè£…ã‚’çµ„ã‚“ã§ã„ãã¾ã™ã€‚

```main.py
import sys
from pathlib import Path

import ui

sys.path.append(str(Path.cwd()))
from wkwebview import WKWebView

js_func = '''function getShaderCode() {
  const area = document.querySelector('#textArea');
  return `${area.value}`;
}
'''


class View(ui.View):
  def __init__(self, root, save_path, *args, **kwargs):
    ui.View.__init__(self, *args, **kwargs)
    self.save_path = save_path

    self.wv = WKWebView()
    self.wv.flex = 'WH'
    self.add_subview(self.wv)

    self.wv.load_url(str(root))
    self.wv.add_script(js_func)
    self.wv.clear_cache()
    self.set_reload_btn()

  def will_close(self):
    self.refresh_webview()

  def set_reload_btn(self):
    self.refresh_btn = self.create_btn('iob:ios7_refresh_outline_32')
    self.refresh_btn.action = (lambda sender: self.refresh_webview())
    self.right_button_items = [self.refresh_btn]

  def create_btn(self, icon):
    btn_icon = ui.Image.named(icon)
    return ui.ButtonItem(image=btn_icon)

  def refresh_webview(self):
    self.get_shader_code()
    self.wv.reload()

  def get_shader_code(self):
    js_code = 'getShaderCode()'
    self.wv.eval_js_async(js_code, lambda v: overwrite_code(v, self.save_path))


def overwrite_code(value, save_path):
  shader_path = Path(f'{save_path}')
  shader_path.write_text(value, encoding='utf-8')


if __name__ == '__main__':
  entry_point = Path('./docs/index.html')
  save_uri = Path('./docs/shaders/fragment/fragmentMain.js')

  view = View(entry_point, save_uri)
  view.present(style='fullscreen', orientations=['portrait'])

```

WebView ã¨ã—ã¦ã€`wkwebview.py` ã‚’ä½¿ã£ãŸ WKWebView ã®åŸºæœ¬çš„ãªå‡¦ç†ã¯å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚

è¿½åŠ ç‚¹ã¨ã—ã¦:

- `main.py` å´ã§ Javascript å†…ã§å®Ÿè¡Œã•ã›ãŸã„é–¢æ•°ã‚’å®šç¾©
- çµ‚äº†æ™‚ã¨æ›´æ–°æ™‚ã«ã€Web ã‚¢ãƒ—ãƒªå†…ã®ç·¨é›†ã•ã‚ŒãŸã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
- ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ã

Pythonista3 å´ã§å¸Œæœ›ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ã€Pythonista3 ã§æº–å‚™ã•ã›ã‚‹ã“ã¨ã§ã€`./docs` ã®ãƒ•ã‚©ãƒ«ãƒ€ãŒç‹¬ã‚Šç«‹ã¡ã—ã¦ä»–ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¦ã‚‚å•é¡Œãªãã€ä¸è¦ãªæƒ…å ±ãªãå‹•ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

#### `main.py` å´ã§ Javascript å†…ã§å®Ÿè¡Œã•ã›ãŸã„é–¢æ•°ã‚’å®šç¾©

```.py
# js å´ã§å®Ÿè¡Œã—ãŸã„é–¢æ•°ã‚’å®šç¾©
#   å­˜åœ¨ã—ã¦ã„ã‚‹ï¼ˆã¯ãšï¼‰ã®textarea Node ã®å€¤ã‚’æ–‡å­—åˆ—ã§è¿”ã™
js_func = '''function getShaderCode() {
  const area = document.querySelector('#textArea');
  return `${area.value}`;
}
'''


class View(ui.View):
  def __init__(self, root, save_path, *args, **kwargs):
    ui.View.__init__(self, *args, **kwargs)
    self.save_path = save_path

    self.wv = WKWebView()
    self.wv.flex = 'WH'
    self.add_subview(self.wv)

    self.wv.load_url(str(root))
    # url ã‚’èª­ã¿è¾¼ã‚“ã ã‚ã¨ã€å®šç¾©ã—ãŸjs ã®é–¢æ•°ã‚’Web ã‚¢ãƒ—ãƒªå´ã«å®šç¾©ã‚’ã—ã¦ã„ã‚‹
    self.wv.add_script(js_func)
```

`.add_script` ã™ã‚‹ã“ã¨ã§ã€ã¾ã å‘¼ã³å‡ºã—ã¯ã›ãšã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¸Šã«`getShaderCode` é–¢æ•°ãŒå­˜åœ¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

#### çµ‚äº†æ™‚ã¨æ›´æ–°æ™‚ã«ã€Web ã‚¢ãƒ—ãƒªå†…ã®ç·¨é›†ã•ã‚ŒãŸã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

```.py
def get_shader_code(self):
  js_code = 'getShaderCode()'
  self.wv.eval_js_async(js_code, lambda v: overwrite_code(v, self.save_path))
```

Pythonista3ï¼ˆPython ä¸Šï¼‰ ã®`get_shader_code` ãŒå‘¼ã°ã‚ŒãŸæ™‚ã«ã€ä»•è¾¼ã‚“ã§ã„ãŸ`getShaderCode` ãŒ js å´ã§èµ°ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

`.eval_js_async` ã®ç¬¬ä¸€å¼•æ•°ã§ã€js ã®ä¸–ç•Œã«ä½•ã‹ã¡ã‚‡ã£ã‹ã„ã‚’ã‹ã‘ã‚‹æŒ‡ç¤ºãŒã§ãã¾ã™ã€‚ä»Šå›ã¯ä»•è¾¼ã‚“ã é–¢æ•°ã‚’å®Ÿè¡Œã€ç¬¬äºŒå¼•æ•°ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã¨ã—ã¦ã€`return` ã•ã‚ŒãŸæ–‡å­—åˆ—ã®å€¤ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚

#### ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ã

```.py
def overwrite_code(value, save_path):
  shader_path = Path(f'{save_path}')
  shader_path.write_text(value, encoding='utf-8')
```

Pathlib ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã€`Path.write_text` ã§ã€åŠ›æŠ€ã®ã”ã¨ãç„¡ç†çŸ¢ç†ãƒ•ã‚¡ã‚¤ãƒ«ã«æ–‡å­—åˆ—ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚

ç›´ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ã§å­˜åœ¨ã‚’ã—ã¦ã„ã‚Œã°ã€è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ãªã„å ´åˆã«ã¯æ–°è¦ä½œæˆã‚’ã—ã¦ãã‚Œã‚‹ã®ã§ã€ä¸Šæ›¸ãå‡¦ç†åŒæ§˜ Pathlib ã®å‡¦ç†ã¯åŠ›æŠ€ã§ãŠã“ãªã£ã¦ã„ã¾ã™ã€‚

## æ¬¡å›ã¯

ï¼ˆã‚‚ã†ã€Œæ¬¡å›ã¯ã€ã¯ãªã„ã§ã™ã­ã€‚å¯‚ã—ã„ã‚‚ã®ã§ã™ï¼‰

Pythonista3 ã‹ã‚‰ WKWebView ã‚’ä½¿ã„ã€Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½œã‚Œã¾ã—ãŸã­ã€‚

ãã—ã¦ã€ã€ŒPythonista3 ã‹ã‚‰å®Ÿè¡Œã—ã¦ã„ã‚‹ã€ãªã‚‰ã§ã¯ã€ã®æ©Ÿèƒ½ã‚‚ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ï¼ˆç§ã®å ´åˆã¯ï¼‰Pythonista3ï¼ˆPythonï¼‰<-> Javascript é€£æºæ©Ÿèƒ½ã¨ã—ã¦ã€ç™ºæƒ³ãŒä¹ã—ãä»Šå›ã®å®Ÿè£…å†…å®¹ã®ç´¹ä»‹ã«ç”˜ã‚“ã˜ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

ã„ã„æ„Ÿã˜ã«é€£æºã‚’ã™ã‚Œã°ã€ã‚‚ã£ã¨ã‚‚ã£ã¨ã„ã„æ„Ÿã˜ãªä½•ã‹ã—ã‚‰ãŒã§ãã‚‹ã®ã§ã¯ãªã„ã‹ãªã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

GLSL ã«é–¢ã—ã¦ã¯ã€`scene` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç´¹ä»‹ä»¥æ¥ 2 å›ç›®ã§ã™ã­ï¼

å‰å›ã§ã¯ã€`scene` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆSpriteKitï¼‰ ã®ä»•æ§˜ä¸Šã€`vec2 p = (gl_FragCoord.xy * 2.0 - resolution) / min(resolution.x, resolution.y);` ã®æ­£è¦åŒ–å®£è¨€ãŒé›£ã—ã‹ã£ãŸã®ã§ã™ãŒã€ä»Šå›ã‚ˆã‚Šæ°—ã«ã›ãšã«ã‚³ãƒ¼ãƒ‰ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

WebGL ã®ç’°å¢ƒæ§‹ç¯‰ã‚’ã—ã¦ã¿ã‚‹ã¨ã€å®Ÿè£…èƒŒæ™¯ã‚‚è¦‹ãˆã¦ãã‚‹ã®ã§ã€ä½•ã‚’ã‚³ãƒ”ãƒšã—ã¦ OK ã‹ï¼ŸNG ã‹ï¼Ÿã®åˆ¤æ–­ãŒæ—©ããªã‚Š GLSL ç”Ÿæ´»ãŒã‚ˆã‚Šä¸€å±¤è±Šã‹ã«ãªã‚Šã¾ã™ã€‚

[pome-ta/shaderCodeMirror6WebGL](https://github.com/pome-ta/shaderCodeMirror6WebGL)

https://github.com/pome-ta/shaderCodeMirror6WebGL

https://pome-ta.github.io/shaderCodeMirror6WebGL/

ä»Šå›ã¯ã€`textarea` ã§ã‚³ãƒ¼ãƒ‰å…¥åŠ›éƒ¨åˆ†ã¯ã€ãŠèŒ¶ã‚’æ¿ã—ãŸã‹ãŸã¡ã«ãªã£ã¦ã„ã¾ã™ãŒã€CodeMirror ã¨ twigl ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸã€iPhone ã‹ã‚‰ã§ã‚‚ã¾ãç„¡ç†ãªãå…¥åŠ›ã§ãã‚‹ç’°å¢ƒã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

[CodeMirror](https://codemirror.net/)

https://codemirror.net/

https://twigl.app/

[doxas/twigl: twigl.app is an online editor for One tweet shader, with gif generator and sound shader, and broadcast live coding.](https://github.com/doxas/twigl)

https://github.com/doxas/twigl

å®Ÿè£…ã¯åŸºæœ¬çš„ã« Pythonista3 ã§ãŠã“ãªã£ã¦ãŠã‚Šã€ã»ã‚“ã®ä¸€éƒ¨ã® js æ©Ÿèƒ½ã®éƒ¨åˆ†ã‚’ä»–ã® iOS ã‚¢ãƒ—ãƒªã§ä½œã£ã¦ã„ã¾ã™ã€‚

`./docs` ã‚’ç¶ºéº—ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã§ã€ã—ã£ã‹ã‚Šã¨ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã‚‚å‹•ã„ã¦ãã‚Œã‚‹ã®ã¯ã„ã„ã¨ã“ã‚ã§ã™ã­ã€‚

ã“ã“ã¾ã§ã€èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ğŸ‘‡ : 26 æ—¥ç›®

https://qiita.com/pome-ta/items/77a4fe632244919f1709

## ã›ã‚“ã§ã‚“

### Discord

Pythonista3 ã®æ—¥æœ¬èªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã¿ãªã•ã‚“å„ªã—ãã¦ã€ã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã‚‚è¦ªèº«ã«æ•™ãˆã¦ãã‚Œã‚‹ã®ã§ã“ã®æ©Ÿä¼šã«è¦—ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

https://t.co/0IOW2hn1VC

### æ›¸ç±

iPhone/iPad ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã™ã‚‹æœ€å¼·ã®æœ¬ã€‚

- [Python ã‚„ Jupyter ã§ iPhone/iPad å…ˆç«¯æ©Ÿèƒ½ã‚’ç°¡å˜ï½¥è‡ªç”±ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ã€Œæ´»ç”¨ç¯‡ã€ï¼šhirax](https://techbookfest.org/product/1WiyV4LEev3f4YrzesRKWV?productVariantID=axX32srsSgtLtZWUtjkj99)

https://techbookfest.org/product/1WiyV4LEev3f4YrzesRKWV?productVariantID=axX32srsSgtLtZWUtjkj99

- [Python ã‚„ Jupyter ã§ iPhone/iPad å…ˆç«¯æ©Ÿèƒ½ã‚’ç°¡å˜ï½¥è‡ªç”±ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ã€ŒåœŸå°ç¯‡ã€ï¼šhirax](https://techbookfest.org/product/wTZTyeibm5GQ5XgdfMrEBV?productVariantID=kRDmN1udbEYZUWbETdwL8r)

https://techbookfest.org/product/wTZTyeibm5GQ5XgdfMrEBV?productVariantID=kRDmN1udbEYZUWbETdwL8r

### ãã®ä»–

- ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

[Pythonista3 Advent Calendar 2022](https://qiita.com/advent-calendar/2022/pythonista3) ã§ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚Šã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ã‚„å¤‰ãªã¨ã“ã‚ã‚„æ”¹å–„ç‚¹ãªã©ã€‚ã”æŒ‡æ‘˜ã‚„ PR ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ãƒ¼

https://github.com/pome-ta/Pythonista3AdventCalendar2022sampleCode

- Twitter

ãªã‚“ã—ã‹ã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã—ã¦ã„ã¾ã™ãŒã€ãŠæ°—å…¼ã­ãªããŠå£°ãŒã‘ãã ã•ã„ã¾ã›ãƒ¼

https://twitter.com/pome_ta93

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ã‚„ã‚Œã‚‹ã‹ã€ã‚„ã‚Œãªã„ã‹ã€‚ã§ã¯ãªãã€ã‚„ã‚‹ã‚“ã ã‘ã©ã‚‚ã€ç´¹ä»‹èª¬æ˜ã™ã‚‹ã“ã¨ã¯å°½ããªã„ã¨æ€ã†ã‘ã©ã€ç· ã‚åˆ‡ã‚Šå®ˆã‚Œã‚‹ã‹ï¼Ÿã£ã¦è©±ã‚ˆï¼ï¼ˆã‚¯ã‚ºï¼‰<br><br>Pythonista3 Advent Calendar 2022 <a href="https://t.co/JKUxA525Pt">https://t.co/JKUxA525Pt</a> <a href="https://twitter.com/hashtag/Qiita?src=hash&amp;ref_src=twsrc%5Etfw">#Qiita</a></p>&mdash; pome-ta (@pome_ta93) <a href="https://twitter.com/pome_ta93/status/1588570697777152006?ref_src=twsrc%5Etfw">November 4, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

- GitHub

åŸºæœ¬çš„ã« GitHub ã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã’ã¦ã„ã‚‹ã®ã§ã€ä½•ã«ãƒãƒã£ã¦ä½•ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã‹è¦³æ¸¬ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

https://github.com/pome-ta
